<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Body Tracker Pro v15</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --bg:#0f172a;
  --card:#111827;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --accent:#22c55e;
  --warn:#facc15;
  --danger:#ef4444;
}

body {
  margin:0;
  font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:var(--bg);
  color:var(--text);
}

header {
  padding:16px;
  background:#020617;
  border-bottom:1px solid #1f2937;
}

header h1 {
  margin:0;
  font-size:1.2rem;
}

header small {
  color:var(--muted);
}

.tabs {
  display:flex;
  gap:6px;
  padding:10px;
  background:#020617;
  overflow-x:auto;
}

.tab-button {
  background:#111827;
  color:var(--text);
  border:1px solid #1f2937;
  border-radius:6px;
  padding:8px 12px;
  cursor:pointer;
  white-space:nowrap;
}

.tab-button.active {
  background:var(--accent);
  color:#022c22;
  font-weight:600;
}

.main {
  padding:12px;
}

.tab {
  display:none;
}

.tab.active {
  display:block;
}

.card {
  background:var(--card);
  border:1px solid #1f2937;
  border-radius:10px;
  padding:12px;
  margin-bottom:12px;
}

.card h3 {
  margin-top:0;
}

table {
  width:100%;
  border-collapse:collapse;
  font-size:0.85rem;
}

th,td {
  padding:6px;
  border-bottom:1px solid #1f2937;
  text-align:center;
}

th {
  color:var(--muted);
}

.badge {
  padding:2px 6px;
  border-radius:6px;
  font-size:0.7rem;
}

.good { background:#14532d; color:#bbf7d0; }
.warn { background:#78350f; color:#fde68a; }
.bad { background:#7f1d1d; color:#fecaca; }
</style>
</head>

<body>

<header>
  <h1>Body Tracker Pro <small>v15 • Only Strong • Joshua 1:9</small></h1>
  <small>Plan the work. Work the plan. Built for transformation.</small>
</header>

<div class="tabs">
  <button class="tab-button active" onclick="switchTab('dashboard',this)">Dashboard</button>
  <button class="tab-button" onclick="switchTab('data',this)">All Data</button>
  <button class="tab-button" onclick="switchTab('analytics',this)">Analytics</button>
  <button class="tab-button" onclick="switchTab('progressive',this)">Progressive</button>
  <button class="tab-button" onclick="switchTab('settings',this)">Settings</button>
</div>

<div class="main">

<!-- DASHBOARD -->
<div id="dashboard" class="tab active">
  <div class="card">
    <h3>Goal Projection</h3>
    <p id="goalText">No data yet.</p>
  </div>

  <div class="card">
    <h3>Health Statistics</h3>
    <p id="healthText">Awaiting entries.</p>
  </div>
</div>

<!-- DATA -->
<div id="data" class="tab">
  <div class="card">
    <h3>All Entries</h3>
    <div style="overflow-x:auto">
      <table id="dataTable">
        <thead>
          <tr>
            <th>Date</th>
            <th>Weight</th>
            <th>BF%</th>
            <th>Lean</th>
            <th>Calories</th>
            <th>Protein</th>
            <th>RHR</th>
            <th>Water%</th>
            <th>Quality</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>

<!-- ANALYTICS -->
<div id="analytics" class="tab">
  <div class="card">
    <h3>Analytics</h3>
    <p>Advanced analytics coming online.</p>
  </div>
</div>

<!-- PROGRESSIVE -->
<div id="progressive" class="tab">
  <div class="card">
    <h3>Progressive Overload</h3>
    <p>Volume trends, PRs, and deload detection will appear here.</p>
  </div>
</div>

<!-- SETTINGS -->
<div id="settings" class="tab">
  <div class="card">
    <h3>Data Management</h3>
    <button onclick="exportJSON()">Export Backup</button>
    <input type="file" accept=".json" onchange="importJSON(event)">
  </div>
</div>

</div>

<script>
/* ---------------- DATA ---------------- */
let bodyData = JSON.parse(localStorage.getItem('bodyData') || '[]');

/* Migration: water_percent → body_water_percent */
bodyData = bodyData.map(e => {
  if (e.body_water_percent == null && e.water_percent != null) {
    e.body_water_percent = e.water_percent;
  }
  return e;
});
saveData();

/* ---------------- UI ---------------- */
function switchTab(id, btn) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  btn.classList.add('active');
}

/* ---------------- RENDER ---------------- */
function renderTable() {
  const tbody = document.querySelector('#dataTable tbody');
  tbody.innerHTML = '';
  [...bodyData].sort((a,b)=>a.date.localeCompare(b.date)).forEach(e => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${e.date||''}</td>
      <td>${e.weight||''}</td>
      <td>${e.bf_percent||''}</td>
      <td>${e.lean_mass||''}</td>
      <td>${e.calories||''}</td>
      <td>${e.protein||''}</td>
      <td>${e.rhr||''}</td>
      <td>${e.body_water_percent||''}</td>
      <td>${qualityBadge(e)}</td>
    `;
    tbody.appendChild(tr);
  });
}

function qualityBadge(e) {
  let score = 0;
  if (e.weight) score++;
  if (e.bf_percent) score++;
  if (e.calories) score++;
  if (e.body_water_percent) score++;

  if (score >= 4) return `<span class="badge good">Good</span>`;
  if (score >= 2) return `<span class="badge warn">Check</span>`;
  return `<span class="badge bad">Poor</span>`;
}

function renderDashboard() {
  if (!bodyData.length) return;
  const last = bodyData[bodyData.length-1];
  document.getElementById('goalText').textContent =
    `Latest weight: ${last.weight || '—'} lbs | BF%: ${last.bf_percent || '—'}`;
  document.getElementById('healthText').textContent =
    `RHR: ${last.rhr || '—'} | Water: ${last.body_water_percent || '—'}%`;
}

/* ---------------- STORAGE ---------------- */
function saveData() {
  localStorage.setItem('bodyData', JSON.stringify(bodyData));
}

function exportJSON() {
  const blob = new Blob([JSON.stringify(bodyData,null,2)], {type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'body-tracker-backup.json';
  a.click();
}

function importJSON(evt) {
  const file = evt.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    try {
      bodyData = JSON.parse(e.target.result);
      saveData();
      renderAll();
      alert('Import successful');
    } catch {
      alert('Invalid JSON file');
    }
  };
  reader.readAsText(file);
}

/* ---------------- INIT ---------------- */
function renderAll() {
  renderTable();
  renderDashboard();
}

renderAll();
</script>

</body>
</html>
